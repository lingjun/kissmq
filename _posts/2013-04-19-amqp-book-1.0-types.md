---
layout: post
title: AMQP 规范1.0 --- 类型系统
layout: post
category : 规范
tagline: "V1.0 类型系统"
tags : [V1.0, 类型系统]
---

<!--# 第一部分 类型     -->

## 1.1 类型系统
AMQP类型系统定义了一组用于互相协调数据表示的通用基本类型。AMQP值(value)可以用基本类型之外的附加语义信息来标记(annotate)，这可以在AMQP值与非AMQP基本类型表示的外部类型之间进行关联。举个例子来说，URL通常使用字符串来表示，但并不是所有的字符串都是有效的URL，所以很多编程语言和应用程序定义了一个专用类型来表示URL。当一个字符串打算用来表示URL时，AMQP类型系统允许定义一个编码(code)用来标记。
<!--break-->
### 1.1.1 原始类型(primitive types)
定义的原始类型如下：

    null         表示一个空值
    boolean      表示true或false值
    ubyte        [0,2^8-1]的整数
    ushort       [0,2^16-1]的整数
    uint         [0,2^32-1]的整数
    ulong        [0,2^64-1]的整数
    byte         [-2^7,2^7-1]的整数
    short        [-2^15,2^15-1]的整数
    int          [-2^31,2^31-1]的整数
    long         [-2^63,2^63-1]的整数
    float        32位浮点数(IEEE 754-2008 binary32)
    double       64位浮点数(IEEE 754-2008 binary64)
    decimal32    32位十进制数字(IEEE 754-2008 decimal32)
    decimal64    64位十进制数字(IEEE 754-2008 decimal64)
    decimal128   128位十进制数字(IEEE 754-2008 decimal128)
    char         单个unicode字符
    timestamp    时间表示的绝对点
    uuid         由RFC-4122 4.1.2部分定义的全局唯一ID
    binary       8位字节序列
    string       unicode字符序列
    symbol       受限领域的符号值
    list         多类型的值序列
    map          从不同键到值的多类型映射
    array        单一类型的值序列
    

### 1.1.2 描述类型(described type)
现有大多数流行编程语言的很多基本类型(basic types),AMQP定义的原始类型都可以直接表示，因此基本数据几乎不需要交换。在实际应用中，即使最简单的应用程序也有用来表示自己领域模型概念的定制类型集，因此对于消息应用来说，这些定制类型需要外化(externalized)以便于传输。
 
通过允许将AMQP类型标记为一个描述符(descriptor),AMQP提供了一种解决方案。描述符在定制类型和AMQP类型之间形成一个关联(association)，这个关联意味着AMQP类型实际上表示(representation)着定制类型。而AMQP类型与它的描述符一起被称为描述类型。
 
描述类型具有两个不同种类的类型信息，它既定义了AMQP类型，又定义了定制类型(当然还包括它们之间的关系)，所有在两个不同层次它都容易理解。对指定领域更加了解的应用可以将描述类型理解为所表示的定制类型，因此可以通过领域的完整语义进行解码和处理，而对领域不熟悉的应用仍然可以将描述类型理解为AMQP类型来进行解码和处理。

### 1.1.3 描述符值(descriptor values)
与符号的(symbol)或数字的（ulong）值不同,描述符值在句法无效时被保留---这包含了数字类型与ulong的不同之处。为了允许类型流的用户来定义自己的描述符而不与描述符值冲突，下面定义了符号与数字描述符的分配策略。
 
符号与数字的描述符命名空间被分为不同的领域。每个领域有一个定义的符号和一个由AMQP工作组分配的4个字节的数字ID。对于数字ID来说，分配的领域ID(domain-id)与[IANA请求组织的私有企业号(PEN)](http://www.iana.org/assignments/enterprise-numbers)相等，根据AMQP说明，领域ID为0的描述符被保留。
 
描述符在领域的分配规则如下：

符号描述符

    <domain>:<name>
数字描述符

    (domain-id << 32) | descriptor-id

## 1.2 类型编码(type encodings)
AMQP编码数据流由内嵌构造子(embedded constructors)的无类型字节组成。内嵌构造子指示了如何解释后面的无类型字节，构造子可以被理解为一个从打开的字节流消费无类型字节并构建一个类型值的函数。AMQP在编码数据流时始终以构造子开头。

          constructor        untyped bytes
             |                    |
           +--+ +-----------------+-----------------+
           |  | |                                   |
       ... 0xA1 0x1E "Hello Glorious Messaging World" ...
            |   |  |              |                 |
            |   |  |         utf8 bytes             |
            |   |  |                                |
            |   | # of data octets                  |
            |   |                                   |
            |   +-----------------+-----------------+
            |                     |
            |      string value encoded according
            |       to the str8-utf8 encoding
            |
    primitive format code
    for the str8-utf8 encoding
     Figure 1.1: Primitive Format Code (String)
 
AMQP构造子由原始格式码或描述格式码组成。原始格式码是AMQP原始类型的构造子，描述格式码由原始格式码和描述符组成。描述符定义了怎么从AMQP原始值生产一个领域指定值。


                constructor                       untyped bytes
                     |                                 |
         +-----------+-----------+   +-----------------+-----------------+
         |                       |   |                                   |
    ...  0x00 0xA1 0x03 "URL" 0xA1   0x1E "http://example.org/hello-world"  ...
              |             |  |     |                                   |
              +------+------+  |     |                                   |
                     |         |     |                                   |
                descriptor     |     +------------------+----------------+
                               |                        |
                               |         string value encoded according
                               |           to the str8-utf8 encoding
                               |
                      primitive format code
                    for the str8-utf8 encoding

         (Note: this example shows a string-typed descriptor, which should be
          considered reserved)
图2Figure 1.2: Described Format Code (URL)
 
描述格式码的描述符部分是它自身任意有效的AMQP编码值，包括其它的描述值。构造子的正式BNF如下：

      constructor = format-code
                  / %x00 descriptor constructor

      format-code = fixed / variable / compound / array
            fixed = empty / fixed-one / fixed-two / fixed-four
                  / fixed-eight / fixed-sixteen
         variable = variable-one / variable-four
         compound = compound-one / compound-four
            array = array-one / array-four

       descriptor = value
            value = constructor untyped-bytes
    untyped-bytes = *OCTET ; this is not actually *OCTET, the
                           ; valid byte sequences are restricted
                           ; by the constructor

    ; fixed width format codes
            empty = %x40-4E / %x4F %x00-FF
        fixed-one = %x50-5E / %x5F %x00-FF
        fixed-two = %x60-6E / %x6F %x00-FF
       fixed-four = %x70-7E / %x7F %x00-FF
      fixed-eight = %x80-8E / %x8F %x00-FF
    fixed-sixteen = %x90-9E / %x9F %x00-FF

    ; variable width format codes
     variable-one = %xA0-AE / %xAF %x00-FF
    variable-four = %xB0-BE / %xBF %x00-FF

    ; compound format codes
     compound-one = %xC0-CE / %xCF %x00-FF
    compound-four = %xD0-DE / %xDF %x00-FF

    ; array format codes
        array-one = %xE0-EE / %xEF %x00-FF
       array-four = %xF0-FE / %xFF %x00-FF

 图3 Figure 1.3: Constructor BNF

格式码映射到如下的四个不同类目：固定宽度、可变宽度、混合型、数组型。同一类目的编码值共享相同的以宽度为参数的基本结构，在同一格式码下的子类目标识(inentify)了类目和宽度。

**固定宽度** 
   固定宽度数据的大小完全由定宽值格式码的子类目决定。

**可变宽度** 
可变宽度数据的大小基于数据前缀的编码大小决定。编码大小的宽度由变宽值的格式码的子类目决定。

**混合型** 混合型数据编码成大小和计数(count)，计数后跟着计数值个连续的类型序列。每个连续值的前面是标识语义的构造子，后面是编码过的数据。大小和计数的宽度由混合值格式码的子类目决定。

**数组型** 数组数据编码成大小和计数，计数后跟随的是数组元素构造子，之后的内容是根据提供的数组元素构造子编码的同态值序列。大小和计数的宽度由数组格式码的子类目决定。

可以通过如下的布局来解释格式码中的位：

    Bit:  7    6    5    4    3    2    1    0
         +------------------------------------+ +----------+
         |   subcategory   |     subtype      | | ext-type |
         +------------------------------------+ +----------+
                       1 octet                    1 octet
         |                                                 |
         +-------------------------------------------------+
                                 |
                            format-code

         ext-type: only present if subtype is 0xF

格式码

下面的表格描述了格式码的子类目：

    Subcategory  Category        Format
    ==============================================================================
    0x4          Fixed Width     Zero octets of data.
    0x5          Fixed Width     One octet of data.
    0x6          Fixed Width     Two octets of data.
    0x7          Fixed Width     Four octets of data.
    0x8          Fixed Width     Eight octets of data.
    0x9          Fixed Width     Sixteen octets of data.

    0xA          Variable Width  One octet of size, 0-255 octets of data.
    0xB          Variable Width  Four octets of size, 0-4294967295 octets of data.

    0xC          Compound        One octet each of size and count, 0-255 distinctly
                             typed values.
    0xD          Compound        Four octets each of size and count, 0-4294967295
                             distinctly typed values.

    0xE          Array           One octet each of size and count, 0-255 uniformly
                             typed values.
    0xF          Array           Four octets each of size and count, 0-4294967295
                             uniformly typed values.

注意，除非额外说明，AMQP对所有的数字值使用网络字节序。

### 1.2.1  固定宽度
定宽编码的宽度可以由定宽值格式码的子类目中计算出来：
 
        n OCTETs
      +----------+
      |   data   |
      +----------+

    Subcategory     n
    =================
    0x4             0
    0x5             1
    0x6             2
    0x7             4
    0x8             8
    0x9             16
    
类型: `null`

    <type name="null" class="primitive" />
    
 编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |---
|0x40 |xed-width, 0字节值|null值
 
类型: `boolean`

    <type name="boolean" class="primitive" />
 
 编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |---
      |  0x56 |固定宽度, 1字节值|八位字节0x00为`false`而八位字节0x01为`true`的boolean值
true  |  0x41 |固定宽度, 0字节值|boolean值`true`
false |  0x42 |固定宽度, 0字节值|boolean值`false`
 
类型: `ubyte` 

    <type name="ubyte" class="primitive"/>
    
 编码 | 编码值 |          类目     | 描述    
----- | ----- | -----------------|---
      |  0x50 | xed-width, 1字节值| 8位无符号整型


类型: `ushort`


    <type name="ushort" class="primitive"/>

    
 编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |---
      |0x60 |xed-width, 2字节值|16位网络字节序的无符号整型

类型: `uint`      

    <type name="uint" class="primitive"/>    


 编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |---    
|0x70 |xed-width, 4字节值| 32位网络字节序的无符号整型  
smalluint|0x52 |xed-width, 1字节值|[0,255]的无符号整型
uint0|0x43 |xed-width, 0字节值 | uint值0      

类型: `ulong`      
 
    <type name="ulong" class="primitive"/>  

  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |---    
|0x80 |xed-width, 8字节值 |64位网络字节序的无符号整型 
smallulong| 0x53 |xed-width, 1字节值| [0,255]的无符号长整型
ulong0 |0x44 |xed-width, 0字节值| ulong值0 
    

类型: `byte`


    <type name="byte" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |---  
|0x51 |xed-width, 1字节值| 8位二进制补码整数值

类型: `short`


    <type name="short" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |---  
|0x61 |xed-width, 2字节值|16位网络字节序的二进制补码整数值


类型: `int`


    <type name="int" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
 |0x71 |xed-width, 4字节值| 32位网络字节序的二进制补码整数值
 smallint| 0x54 |xed-width, 1字节值|[-128,127]的有符号整数值

类型: `long`


    <type name="long" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |---  
|0x81 |xed-width, 8字节值|64位网络字节序的二进制补码整数值   
smalllong| 0x55|xed-width, 1字节值|[-128,127]的有符号长整数值 


类型: `float`

    <type name="float" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |---
ieee-754| 0x72 |xed-width, 4字节值| IEEE 754-2008 binary32

类型: `double`


    <type name="double" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
ieee-754 |0x82 |xed-width, 8字节值| IEEE 754-2008 binary64

类型: `decimal32`


    <type name="decimal32" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
ieee-754| 0x74 |xed-width, 4字节值|使用二进制整数十进制编码的IEEE 754-2008 decimal32

类型: `decimal64`


    <type name="decimal64" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
ieee-754 |0x84 |xed-width, 8字节值|使用二进制整数十进制编码的IEEE 754-2008 decimal64


类型: `decimal128`


    <type name="decimal128" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
ieee-754| 0x94 |xed-width, 16字节值|使用二进制整数十进制编码的IEEE 754-2008 decimal128


类型: `char`


    <type name="char" class="primitive"/>

  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
utf32 |0x73| xed-width, 4字节值| UTF-32BE编码的unicode字符

类型: `timestamp`

    <type name="timestamp" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
ms64 |0x83 |xed-width, 8字节值| 表示根据unix周期的毫秒的64位无符号整数


    使用UTC编码的Unix的time_t表示的时间的近似点，以毫秒作为精度。举例来说，1311704463521表示2011-07-26T18:21:03.521Z这一时刻。


类型: `uuid`

    <type name="uuid" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
|0x98 |xed-width, 16字节值|在RFC-4122的4.1.2定义的UUID



### 1.2.2 可变宽度
所有变宽编码是这样组成的：八进制表示的大小，后面跟着编码数据的八进制大小。具体变宽的宽度大小可以由格式码的子类目计算出来：
 
       n OCTETs   size OCTETs
    +----------+-------------+
    |   size   |    value    |
    +----------+-------------+

        Subcategory     n
        =================
        0xA             1
        0xB             4

 
 类型: `binary`
 
    <type name="binary" class="primitive"/>
  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
vbin8| 0xa0 |可变宽度, 1字节大小|最多$$$2^8 - 1$$$个二进制数据的octets
vbin32| 0xb0 |可变宽度, 4字节大小|最多$$$2^{32} - 1$$$个二进制数据的octets


类型: `string`


    <type name="string" class="primitive"/>

string表示由Unicode V6.0.0标准(参见[http://www.unicode.org/versions/Unicode6.0.0](http://www.unicode.org/versions/Unicode6.0.0))定义的unicode字符的序列。


  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
str8-utf8 |0xa1 |可变宽度, 1字节大小|最多$$$2^8 - 1$$$ 个UTF-8 unicode(没有字节顺序码)的octets
str32-utf8| 0xb1|可变宽度, 4字节大小|最多 $$$2^{32} - 1$$$ 个UTF-8 unicode(没有字节顺序码)的octets


类型: `symbol`


    <type name="symbol" class="primitive"/>

符号是首先领域的值。尽管可能的领域集是开放的(open-ended)，具有代表性的是任何给定应用在用符号的数字和大小都会很小，举例来说，小到将所有直接值都缓存起来都是合理的。

  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
sym8 |0xa3 |可变宽度, 1字节大小|最多$$$2^8 - 1$$$个表示符号值的7位ASCII字符
sym32| 0xb3|可变宽度, 4字节大小|最多$$$2^{32} - 1$$$个表示符号值的7位ASCII字符
 
 

### 1.2.3 混合型
所有混合型的编码由大小和跟随着计数编码条目的计数器组成。具体混合型编码的的大小和计数宽度可以由格式码的类名计算出来：
 
                          +----------= count items =----------+
                          |                                   |
      n OCTETs   n OCTETs |                                   |
    +----------+----------+--------------+------------+-------+
    |   size   |  count   |      ...    /|    item    |\ ...  |
    +----------+----------+------------/ +------------+ \-----+
                                      / /              \ \
                                     / /                \ \
                                    / /                  \ \
                                   +-------------+----------+
                                   | constructor |   data   |
                                   +-------------+----------+

                       Subcategory     n
                       =================
                       0xC             1
                       0xD             4
 
 
类型: `list`

    <type name="list" class="primitive"/>

  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
list0| 0x45| xed-width, 0字节大小|空列表(也就是说: 没有任何元素的列表)
list8 |0xc0 |variable-width, 1字节大小|最多$$$2^8 - 1$$$ 个列表元素，总大小小于$$$2^8$$$个octets
list32 |0xd0 |variable-width, 4字节大小|最多$$$2^{32} - 1$$$列表元素，总大小小于$$$2^{32}$$$个octets


类型: `map`


    <type name="map" class="primitive"/> 


map被编码为混合类型值，他的组成元素构成任选的键值对。

     item 0   item 1      item n-1    item n
    +-------+-------+----+---------+---------+
    | key 1 | val 1 | .. | key n/2 | val n/2 |
    +-------+-------+----+---------+---------+

Map编码必须包含偶数个条目(也就是说，键和值的数量相等)。包含两个一样键值的map是无效的。除非特别说明，map都被认为是有序的，键值对的顺序在语义上是非常重要的，两个仅仅在键值对顺序上不同的map的编码是不相等的，因此是不同的。

  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
map8 |0xc1|变宽，1字节大小|最多$$$2^8 - 1$$$个编码map数据的 octets
map32| 0xd1 |变宽，4字节大小|最多$$$2^{32} - 1$$$个编码map数据的 octets 

### 1.2.4 数组
所有的数组编码由大小、跟随着元素构造子的计数器、元素构造子后面跟随着按元素构造子要求格式编码的编码数据。

                                                +--= count elements =--+
                                                |                      |
      n OCTETs   n OCTETs                       |                      |
    +----------+----------+---------------------+-------+------+-------+
    |   size   |  count   | element-constructor |  ...  | data |  ...  |
    +----------+----------+---------------------+-------+------+-------+

                            Subcategory     n
                            =================
                            0xE             1
                            0xF             4
 
类型: `array`

    <type name="array" class="primitive"/>

  编码  | 编码值 |        类目   | 描述    
----- | ----- | ------------- |--- 
array8 |0xe0|变宽，1字节大小|最多$$$2^8 - 1$$$个数组元素，总大小小于$$$2^8$$$个octets
array32| 0xf0|变宽，4字节大小|最多$$$2^{32} - 1$$$个数组元素，总大小小于$$$2^{32}$$$个octets 
 
 
 
### 1.2.5 编码列表
 
  类型|编码  | 编码值 |        类目   | 描述    
---|----- | ----- | ------------- |---
null||0x40 |xed-width, 0字节值|null值
boolean|      |  0x56 |固定宽度, 1字节值|八位字节0x00为`false`而八位字节0x01为`true`的boolean值
boolean|true  |  0x41 |固定宽度, 0字节值|boolean值`true`
boolean|false |  0x42 |固定宽度, 0字节值|boolean值`false`
 ubyte|     |  0x50 | xed-width, 1字节值| 8位无符号整型
 ushort|     |0x60 |xed-width, 2字节值|16位网络字节序的无符号整型  
uint||0x70 |xed-width, 4字节值| 32位网络字节序的无符号整型  
uint|smalluint|0x52 |xed-width, 1字节值|[0,255]的无符号整型
uint|uint0|0x43 |xed-width, 0字节值 | uint值0         
ulong||0x80 |xed-width, 8字节值 |64位网络字节序的无符号整型 
ulong|smallulong| 0x53 |xed-width, 1字节值| [0,255]的无符号长整型
ulong|ulong0 |0x44 |xed-width, 0字节值| ulong值0  
byte||0x51 |xed-width, 1字节值| 8位二进制补码整数值
short||0x61 |xed-width, 2字节值|16位网络字节序的二进制补码整数值
int| |0x71 |xed-width, 4字节值| 32位网络字节序的二进制补码整数值
int| smallint| 0x54 |xed-width, 1字节值|[-128,127]的有符号整数值
long| |0x81 |xed-width, 8字节值|64位网络字节序的二进制补码整数值        
long|smalllong| 0x55|xed-width, 1字节值|[-128,127]的有符号长整数值
float|ieee-754| 0x72 |xed-width, 4字节值| IEEE 754-2008 binary32
double|ieee-754 |0x82 |xed-width, 8字节值| IEEE 754-2008 binary64
decimal32|ieee-754| 0x74 |xed-width, 4字节值|使用二进制整数十进制编码的IEEE 754-2008 decimal32
decimal64|ieee-754 |0x84 |xed-width, 8字节值|使用二进制整数十进制编码的IEEE 754-2008 decimal64
decimal128|ieee-754| 0x94 |xed-width, 16字节值|使用二进制整数十进制编码的IEEE 754-2008 decimal128
char|utf32 |0x73| xed-width, 4字节值| UTF-32BE编码的unicode字符
timestamp|ms64 |0x83 |xed-width, 8字节值| 表示根据unix周期的毫秒的64位无符号整数
uuid||0x98 |xed-width, 16字节值|在RFC-4122的4.1.2定义的UUID
binary|vbin8| 0xa0 |可变宽度, 1字节大小|最多$$$2^8 - 1$$$个二进制数据的octets
binary|vbin32| 0xb0 |可变宽度, 4字节大小|最多$$$2^{32} - 1$$$个二进制数据的octets
string|str8-utf8 |0xa1 |可变宽度, 1字节大小|最多$$$2^8 - 1$$$ 个UTF-8 unicode(没有字节顺序码)的octets
string|str32-utf8| 0xb1|可变宽度, 4字节大小|最多 $$$2^{32} - 1$$$ 个UTF-8 unicode(没有字节顺序码)的octets
symbol|sym8 |0xa3 |可变宽度, 1字节大小|最多$$$2^8 - 1$$$个表示符号值的7位ASCII字符
symbol|sym32| 0xb3|可变宽度, 4字节大小|最多$$$2^{32} - 1$$$个表示符号值的7位ASCII字符
list|list0| 0x45| xed-width, 0字节大小|空列表(也就是说: 没有任何元素的列表)
list|list8 |0xc0 |variable-width, 1字节大小|最多$$$2^8 - 1$$$ 个列表元素，总大小小于$$$2^8$$$个octets
list|list32 |0xd0 |variable-width, 4字节大小|最多$$$2^{32} - 1$$$列表元素，总大小小于$$$2^{32}$$$个octets
map|map8 |0xc1|变宽，1字节大小|最多$$$2^8 - 1$$$个编码map数据的 octets
map|map32| 0xd1 |变宽，4字节大小|最多$$$2^{32} - 1$$$个编码map数据的 octets 
array|array8 |0xe0|变宽，1字节大小|最多$$$2^8 - 1$$$个数组元素，总大小小于$$$2^8$$$个octets
array|array32| 0xf0|变宽，4字节大小|最多$$$2^{32} - 1$$$个数组元素，总大小小于$$$2^{32}$$$个octets 


## 1.3 复合类型(Composite types)
AMQP定义了大量用来编码诸如帧(frame body)结构化数据的复合类型。复合类型描述了复合值，复合制的每个组成值被标识为大家熟知的字段(field)。每个复合类型定义包含了有序的字段序列，每个字段具有特定的名字、类型和重数。复合类型定义同样也包含了一个或多个描述符(符号的或数字的)来标识所定义的表示。

复合类型的正式定义为包含规格的XML文档，下面的符号用来定义：

    <type class="composite" name="book" label="example composite type">
      <doc>
        <p>An example composite type.</p>
      </doc>

      <descriptor name="example:book:list" code="0x00000003:0x00000002"/>

      <field name="title" type="string" mandatory="true" label="title of the book"/>

      <field name="authors" type="string" multiple="true"/>

      <field name="isbn" type="string" label="the ISBN code for the book"/>
    </type>
              图 1.4 复合类型的例子
 
字段描述的mandatory属性控制了表示中是否允许存在null元素。

字段描述的multiple属性控制在表示中是否允许有多个元素。字段描述中指定类型的单一元素总是允许的，多个值由一个数组来表示，数组中的元素类型由字段定义的类型来决定。需要注意的是null值和长度为0的s数组(正确的元素类型)都描述了值缺失，应该被认为是语义相同的。

被定义为multiple和mandatary的字段必须包含至少一个值(也就是说，对于这样的字段，null和没有元素的数组都是无效的)。


### 1.3.1 list编码
AMQP复合值被编码为描述的列表。列表中的每个元素和复合类型定义的字段在位置上相互对应。允许的元素值由类型规约和相应字段定义的多重性决定。当列表表示的尾随元素为null时，可能会被忽略。列表的描述符意味着具体的复合类型已经被表示。

下面是一个示例，显示了上述定义的book类型的复合值的描述列表。在本例中，跟ISBN值后跟随的是null元素，但被描述了出来，但根据编码规则，这个值可以被忽略。

                 constructor                  list representation of a book
                      |                                   |
    +-----------------+-------------------+ +-------------+---------------+
    |                                     | |                             |
    0x00 0xA3 0x11 "example:book:list" 0xC0 0x40 0x03  title  authors  isbn
          |                 |                            |       |       |
          |      identifies composite type               |       |       |
          |                                              |       |     0x40
        sym8                      +----------------------+       |       |
      (symbol)                    |                              |  null value
                   +--------------+----------------+             |
                   |                               |             |
                   0xA1 0x15 "AMQP for & by Dummies"             |
                                                                 |
    +------------------------------------------------------------+-----+
    |                                                                  |
    0xE0 0x25 0x02 0xA1 0x0E "Rob J. Godfrey" 0x13 "Rafael H. Schloming"
          |    |    |   |                   | |                        |
        size   |    |   +---------+---------+ +-----------+------------+
               |    |             |                       |
             count  |        first element          second element
                    |
             element constructor



 
